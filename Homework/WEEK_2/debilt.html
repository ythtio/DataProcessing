<!-- 
Yol Tio 10753222
Minor Programmeren
The HTML file contains data obtained from the KNMI.
The following JavaScript processes the data to a linear graph.

Assignment : https://data.mprog.nl/homework/javascript
Data Source : http://projects.knmi.nl/klimatologie/daggegevens/selectie.cgi
 -->


<!DOCTYPE html>
<html>
<head>
	<title> Average temperatures de Bilt </title>
	<h1>
		Linegraph with Javascript
	</h1> 
	<h2>
		Yol Tien Ho Tio, 10753222 </br>	source: <a href="">http://projects.knmi.nl/klimatologie/daggegevens/selectie.cgi</a>
	</h2>
</head>

<body>
	<canvas id="myCanvas" width = "800" height = "500"
			style = "border:1px solid #d3d3d3;"
	></canvas>
	<textarea id="rawdata" name="hide" style="display:none;">
		19960101,  -14
		19960102,  -21
		19960103,  -13
		19960104,    5
		19960105,   -7
		19960106,  -30
		19960107,   40
		19960108,   47
		19960109,   53
		19960110,   57
		19960111,   63
		19960112,   87
		19960113,   81
		19960114,   56
		19960115,   29
		19960116,   13
		19960117,    7
		19960118,   -9
		19960119,  -18
		19960120,   -8
		19960121,   -8
		19960122,   -9
		19960123,  -39
		19960124,  -36
		19960125,  -78
		19960126,  -92
		19960127,  -59
		19960128,  -47
		19960129,  -31
		19960130,  -24
		19960131,  -24
		19960201,  -22
		19960202,  -16
		19960203,  -11
		19960204,   -1
		19960205,   -6
		19960206,  -37
		19960207,  -53
		19960208,  -80
		19960209,  -46
		19960210,   27
		19960211,   41
		19960212,   36
		19960213,   11
		19960214,   -8
		19960215,    3
		19960216,   60
		19960217,   54
		19960218,   46
		19960219,    1
		19960220,  -28
		19960221,  -40
		19960222,  -13
		19960223,   -3
		19960224,   29
		19960225,   76
		19960226,   50
		19960227,   32
		19960228,   31
		19960229,   28
		19960301,   26
		19960302,   10
		19960303,    7
		19960304,   14
		19960305,   24
		19960306,   45
		19960307,   30
		19960308,   34
		19960309,   33
		19960310,   24
		19960311,  -10
		19960312,  -23
		19960313,  -19
		19960314,    8
		19960315,   34
		19960316,   39
		19960317,   47
		19960318,   49
		19960319,   42
		19960320,   62
		19960321,   77
		19960322,   75
		19960323,   86
		19960324,   58
		19960325,   78
		19960326,   28
		19960327,   20
		19960328,   24
		19960329,   35
		19960330,   23
		19960331,   15
		19960401,    6
		19960402,    8
		19960403,   30
		19960404,   59
		19960405,   67
		19960406,   67
		19960407,   65
		19960408,   66
		19960409,   87
		19960410,  108
		19960411,   79
		19960412,   31
		19960413,   51
		19960414,   67
		19960415,   88
		19960416,  121
		19960417,  132
		19960418,  111
		19960419,  140
		19960420,  164
		19960421,  176
		19960422,  191
		19960423,  156
		19960424,  111
		19960425,  105
		19960426,  117
		19960427,  132
		19960428,  115
		19960429,   78
		19960430,   88
		19960501,  115
		19960502,  106
		19960503,   81
		19960504,   72
		19960505,   60
		19960506,   76
		19960507,   97
		19960508,   92
		19960509,   92
		19960510,   70
		19960511,   86
		19960512,   86
		19960513,   87
		19960514,   97
		19960515,   87
		19960516,   76
		19960517,   86
		19960518,  108
		19960519,  130
		19960520,  110
		19960521,  108
		19960522,  112
		19960523,  127
		19960524,  147
		19960525,  128
		19960526,  131
		19960527,  109
		19960528,  112
		19960529,  163
		19960530,  201
		19960531,  173
		19960601,  139
		19960602,  136
		19960603,  152
		19960604,  165
		19960605,  210
		19960606,  232
		19960607,  259
		19960608,  217
		19960609,  148
		19960610,  200
		19960611,  205
		19960612,  156
		19960613,  142
		19960614,  122
		19960615,  139
		19960616,  157
		19960617,  177
		19960618,  153
		19960619,  128
		19960620,  122
		19960621,  113
		19960622,  118
		19960623,  116
		19960624,  121
		19960625,  125
		19960626,  161
		19960627,  153
		19960628,  157
		19960629,  130
		19960630,  147
		19960701,  140
		19960702,  143
		19960703,  164
		19960704,  162
		19960705,  144
		19960706,  124
		19960707,  131
		19960708,  126
		19960709,  141
		19960710,  143
		19960711,  174
		19960712,  175
		19960713,  174
		19960714,  174
		19960715,  155
		19960716,  147
		19960717,  149
		19960718,  138
		19960719,  158
		19960720,  186
		19960721,  198
		19960722,  222
		19960723,  205
		19960724,  158
		19960725,  161
		19960726,  176
		19960727,  160
		19960728,  161
		19960729,  186
		19960730,  185
		19960731,  179
		19960801,  167
		19960802,  159
		19960803,  159
		19960804,  176
		19960805,  193
		19960806,  171
		19960807,  151
		19960808,  173
		19960809,  204
		19960810,  206
		19960811,  180
		19960812,  168
		19960813,  187
		19960814,  184
		19960815,  177
		19960816,  163
		19960817,  164
		19960818,  189
		19960819,  222
		19960820,  228
		19960821,  181
		19960822,  178
		19960823,  184
		19960824,  164
		19960825,  153
		19960826,  157
		19960827,  140
		19960828,  146
		19960829,  148
		19960830,  159
		19960831,  133
		19960901,  126
		19960902,  130
		19960903,  149
		19960904,  148
		19960905,  149
		19960906,  130
		19960907,  119
		19960908,  115
		19960909,  138
		19960910,  132
		19960911,  124
		19960912,  129
		19960913,  125
		19960914,  135
		19960915,  121
		19960916,  113
		19960917,  116
		19960918,  114
		19960919,  107
		19960920,  113
		19960921,  102
		19960922,   95
		19960923,  100
		19960924,   99
		19960925,  111
		19960926,  133
		19960927,  145
		19960928,  133
		19960929,  148
		19960930,  147
		19961001,  102
		19961002,   89
		19961003,  120
		19961004,  118
		19961005,   93
		19961006,   87
		19961007,   95
		19961008,  112
		19961009,  125
		19961010,  116
		19961011,  106
		19961012,   95
		19961013,  117
		19961014,  148
		19961015,  130
		19961016,   95
		19961017,   80
		19961018,   90
		19961019,  116
		19961020,  129
		19961021,  127
		19961022,   96
		19961023,   94
		19961024,   99
		19961025,  107
		19961026,  108
		19961027,  112
		19961028,  134
		19961029,  107
		19961030,   97
		19961031,   95
		19961101,  116
		19961102,  139
		19961103,  138
		19961104,  130
		19961105,  100
		19961106,  116
		19961107,   89
		19961108,   63
		19961109,   77
		19961110,   67
		19961111,   65
		19961112,   86
		19961113,   55
		19961114,   27
		19961115,   10
		19961116,   28
		19961117,   23
		19961118,   39
		19961119,   30
		19961120,   56
		19961121,   41
		19961122,   40
		19961123,   17
		19961124,   23
		19961125,   45
		19961126,   38
		19961127,   10
		19961128,   16
		19961129,   34
		19961130,   41
		19961201,   48
		19961202,   74
		19961203,   62
		19961204,   67
		19961205,   49
		19961206,   54
		19961207,   53
		19961208,   19
		19961209,   -3
		19961210,   -4
		19961211,  -10
		19961212,   -6
		19961213,   12
		19961214,    1
		19961215,   67
		19961216,   52
		19961217,   30
		19961218,   55
		19961219,   60
		19961220,    0
		19961221,  -35
		19961222,  -22
		19961223,  -26
		19961224,  -45
		19961225,  -27
		19961226,  -53
		19961227,  -49
		19961228,  -86
		19961229,  -43
		19961230,  -12
		19961231,  -97
	</textarea>
</body>
</html>

<script type="text/javascript">

// sets arrays for loadData
date = []
dates 	= []
days 	= []
daycount = []
temp 	= []

// amount of milliseconds in a day
DAY = 86400000

function loadData() {
	/**
	* loadData returns correct necessary values to convert data into coordinates
	*/

	// gets average temperatures from HTML
	var KNMI = document.getElementById('rawdata').innerHTML;
	
	// split the lines and trims the whitespaces
	KNMI = KNMI.split("\n");
	// https://stackoverflow.com/questions/19293997/javascript-apply-trim-function-to-each-string-in-an-array
	KNMI = KNMI.map(function(s) { return String.prototype.trim.apply(s); });

	// iterates over data, splits dates and temperatures pushing into seperate lists
	for (var i = 0; i < KNMI.length - 1; i++) {
		var spliti = KNMI[i].split(",");
		date.push(spliti[0]);
		temp.push(parseFloat(spliti[1]));

		// puts year, month and days into variables
		// https://stackoverflow.com/questions/10013998/fastest-way-to-parse-a-yyyymmdd-date-in-java
		var year = parseInt(date[i].substring(0, 4));
		var month = parseInt(date[i].substring(4, 6));
		var day = parseInt(date[i].substring(6));

		// reformats date and calculates dates into milliseconds and days
		dates = year + "-" + month + "-" + day;
		var dates = new Date(dates);
		days.push(dates.getTime()) ;
		daycount.push((days[i] - days[0]) / DAY)
	}
	return (dates, daycount, temp)
}

function createTransform(domain, range) {
	/**
	* createTransform calculates alpha and beta, depending on the given domains and ranges and returns a transformation function. 
	*/

	// setting min and max domain and range
    var domain_min = domain[0]
    var domain_max = domain[1]
    var range_min = range[0]
    var range_max = range[1]

    // formulas to calculate the alpha and the beta
   	var alpha = (range_max - range_min) / (domain_max - domain_min)
    var beta = range_max - alpha * domain_max

    // returns the function for the linear transformation (y= a * x + b)
    return function(x) {
      return alpha * x + beta;
    }
}

loadData();

// Calculates max/min temperatures
highTemp 	= Math.max.apply(Math,temp);
lowTemp 	= Math.min.apply(Math,temp);

// setting appropriate indentation of graph
indentGraph = 100

//sets domain and range for createTransformfunction 
domaintemp 	= [lowTemp, highTemp]
domaindate 	= [daycount[0], daycount[365]]
rangetemp 	= [indentGraph, 500]
rangedate	= [indentGraph, 700]
month 		= ['1996', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec']

// calculates x and y coordinates
var yTransform = createTransform(domaintemp,rangetemp);
var xTransform = createTransform(domaindate,rangedate);

// coordinates of highest average temperature
cordHighTemp = yTransform(highTemp)
console.log(cordHighTemp)

// gets canvas
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

// draws title
ctx.font = '24px serif';
ctx.fillText('Maximum Temperature at the Bilt (1996)', 200, 25);

// draws x-axis
ctx.beginPath();
ctx.lineWidth = 2.0;
ctx.moveTo(indentGraph,450);
ctx.lineTo(750,450);

// divides x-axis into 12 
for (var i = 0; i < month.length; i++) {

	// draws strikes x-axis 
	ctx.moveTo(indentGraph + i * 650 / (month.length + 1), 450);
	ctx.lineTo(indentGraph + i * 650 / (month.length + 1), 460);

	// draws month's name
	ctx.font = '12px serif';
	ctx.fillText(month[i], indentGraph + i * 650 / (month.length + 1), 475);
}

// draws y-axis
ctx.moveTo(indentGraph, 450);
ctx.lineTo(indentGraph, 550 - cordHighTemp);

// divides y-axis into 10 parts
for (var i = 0; i < 10; i++) {

	// draws strikes on y-axis
	ctx.moveTo(90, 550 - cordHighTemp + i * (cordHighTemp - indentGraph) / 9);
	ctx.lineTo(indentGraph, 550 - cordHighTemp + i * (cordHighTemp - indentGraph)/ 9);

	// draws temperatures on y-axis
	ctx.fillText(parseInt(lowTemp + i * (highTemp-lowTemp)/9), 60, 455 - i * (cordHighTemp - indentGraph) / 9);
	ctx.stroke();
}

// draws average Temperatures
ctx.beginPath();
ctx.lineWidth = 1.0
ctx.moveTo(xTransform(daycount[0]),550 - yTransform(temp[0]));
for (var i = 0; i < temp.length - 1; i++){
	ctx.lineTo(xTransform(daycount[i]),550 - yTransform(temp[i]));
}

// draws titles of the axes
ctx.font = "16px serif"
ctx.fillText('Temperature (Celsius)', 10, 40);
ctx.fillText('Months', 700, 470)
ctx.stroke()

</script>